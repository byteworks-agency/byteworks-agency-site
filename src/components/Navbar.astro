---
interface Props { lang: 'en' | 'es' }
const { lang = 'en' } = Astro.props;

const links = lang === 'es'
  ? [{ href: '/es/', label: 'Inicio' }, { href: '/es/about', label: 'Sobre nosotros' }, { href: '/es/contact', label: 'Contacto' }]
  : [{ href: '/en/', label: 'Home'  }, { href: '/en/about', label: 'About' }, { href: '/en/contact', label: 'Contact' }];

// WhatsApp (opcional vía .env)
const WAPP = import.meta.env.PUBLIC_WAPP_NUMBER;
const MSG  = import.meta.env.PUBLIC_WAPP_MESSAGE || (lang === 'es' ? 'Hola%20ByteWorks' : 'Hello%20ByteWorks');
const wappUrl = WAPP ? `https://wa.me/${WAPP}?text=${MSG}` : null;
---

<header class="sticky top-0 z-50 w-full bg-white/80 dark:bg-neutral-950/80 backdrop-blur-md border-b border-neutral-200 dark:border-neutral-800">
  <div class="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
    <!-- LOGO light/dark -->
    <a href={`/${lang}/`} class="flex items-center gap-2">
      <picture>
        <source srcset="/logo-dark.png" media="(prefers-color-scheme: dark)" />
        <img src="/logo-light.png" alt="ByteWorks" class="h-7 w-auto" loading="eager" decoding="sync" />
      </picture>
      <span class="sr-only">ByteWorks</span>
    </a>

    <!-- NAV desktop -->
    <nav class="hidden md:flex items-center gap-6 text-sm">
      {links.map(l => (
        <a href={l.href} class="hover:text-brand transition-colors">{l.label}</a>
      ))}

      {wappUrl && (
        <a href={wappUrl} target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-2 px-3 py-1.5 rounded-md border border-neutral-300 dark:border-neutral-700 hover:border-brand/60"
           aria-label={lang === 'es' ? 'Chatear por WhatsApp' : 'Chat on WhatsApp'}>
          <!-- Ícono inline -->
          <svg viewBox="0 0 24 24" aria-hidden="true" class="w-4 h-4" fill="currentColor">
            <path d="M20.52 3.48A11.94 11.94 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.1.55 4.1 1.6 5.9L.04 24l6.26-1.62A11.93 11.93 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.2-1.25-6.22-3.48-8.52ZM12 21.6c-1.86 0-3.66-.5-5.23-1.46l-.37-.22-3.72.96.99-3.62-.24-.37A9.6 9.6 0 1 1 21.6 12c0 5.3-4.3 9.6-9.6 9.6Zm5.47-6.98c-.3-.15-1.76-.86-2.03-.96-.27-.1-.46-.15-.66.15-.2.3-.76.96-.94 1.16-.17.2-.35.22-.65.07-.3-.15-1.24-.46-2.36-1.48-.87-.77-1.46-1.72-1.62-2.02-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.03-.52-.08-.15-.66-1.58-.9-2.17-.24-.58-.48-.5-.66-.5h-.56c-.2 0-.52.08-.8.37-.27.3-1.04 1.02-1.04 2.5 0 1.48 1.07 2.92 1.22 3.12.15.2 2.1 3.2 5.08 4.48.71.31 1.27.5 1.7.64.71.23 1.36.2 1.87.12.57-.08 1.76-.72 2.01-1.42.25-.7.25-1.3.18-1.42-.08-.12-.27-.2-.57-.35Z"/>
          </svg>
          <span>WhatsApp</span>
        </a>
      )}

      <a href={lang === 'es' ? '/?lang=en' : '/?lang=es'}
         class="px-2 py-1 border border-neutral-300 dark:border-neutral-700 rounded-md"
         aria-label={lang === 'es' ? 'Cambiar a inglés' : 'Switch to Spanish'}>
        {lang === 'es' ? 'EN' : 'ES'}
      </a>
    </nav>

    <!-- Hamburguesa (móvil) -->
    <button id="menu-btn"
      class="md:hidden p-2 rounded-md border border-neutral-300 dark:border-neutral-700"
      aria-label={lang === 'es' ? 'Abrir menú' : 'Open menu'}
      aria-expanded="false" aria-controls="mobile-menu">
      <img src="/icons/hamburger.svg" alt="" class="w-5 h-5 dark:invert" />
    </button>
  </div>

  <!-- Menú móvil -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-neutral-200 dark:border-neutral-800 bg-white/95 dark:bg-neutral-950/95">
    <div class="max-w-6xl mx-auto px-4 py-4 flex flex-col gap-3 text-sm">
      <div class="flex items-center justify-between">
        <span class="font-medium">{lang === 'es' ? 'Menú' : 'Menu'}</span>
        <button id="menu-close" class="p-2 rounded-md border border-neutral-300 dark:border-neutral-700" aria-label={lang === 'es' ? 'Cerrar menú' : 'Close menu'}>
          <img src="/icons/close.svg" alt="" class="w-5 h-5 dark:invert" />
        </button>
      </div>

      {links.map(l => (
        <a href={l.href} class="py-2 border-b border-neutral-200/70 dark:border-neutral-800 hover:text-brand">{l.label}</a>
      ))}

      {wappUrl && (
        <a href={wappUrl} target="_blank" rel="noopener noreferrer"
           class="inline-flex items-center gap-2 px-3 py-2 rounded-md border border-neutral-300 dark:border-neutral-700 hover:border-brand/60"
           aria-label={lang === 'es' ? 'Chatear por WhatsApp' : 'Chat on WhatsApp'}>
          <svg viewBox="0 0 24 24" aria-hidden="true" class="w-5 h-5" fill="currentColor">
            <path d="M20.52 3.48A11.94 11.94 0 0 0 12 0C5.37 0 0 5.37 0 12c0 2.1.55 4.1 1.6 5.9L.04 24l6.26-1.62A11.93 11.93 0 0 0 12 24c6.63 0 12-5.37 12-12 0-3.2-1.25-6.22-3.48-8.52ZM12 21.6c-1.86 0-3.66-.5-5.23-1.46l-.37-.22-3.72.96.99-3.62-.24-.37A9.6 9.6 0 1 1 21.6 12c0 5.3-4.3 9.6-9.6 9.6Zm5.47-6.98c-.3-.15-1.76-.86-2.03-.96-.27-.1-.46-.15-.66.15-.2.3-.76.96-.94 1.16-.17.2-.35.22-.65.07-.3-.15-1.24-.46-2.36-1.48-.87-.77-1.46-1.72-1.62-2.02-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2.05-.37-.03-.52-.08-.15-.66-1.58-.9-2.17-.24-.58-.48-.5-.66-.5h-.56c-.2 0-.52.08-.8.37-.27.3-1.04 1.02-1.04 2.5 0 1.48 1.07 2.92 1.22 3.12.15.2 2.1 3.2 5.08 4.48.71.31 1.27.5 1.7.64.71.23 1.36.2 1.87.12.57-.08 1.76-.72 2.01-1.42.25-.7.25-1.3.18-1.42-.08-.12-.27-.2-.57-.35Z"/>
          </svg>
          <span>WhatsApp</span>
        </a>
      )}

      <a href={lang === 'es' ? '/?lang=en' : '/?lang=es'}
         class="inline-block px-3 py-2 rounded-md border border-neutral-300 dark:border-neutral-700"
         aria-label={lang === 'es' ? 'Cambiar a inglés' : 'Switch to Spanish'}>
        {lang === 'es' ? 'EN' : 'ES'}
      </a>
    </div>
  </div>
</header>

<script is:inline>
  const btn = document.getElementById('menu-btn');
  const closeBtn = document.getElementById('menu-close');
  const panel = document.getElementById('mobile-menu');

  function open() {
    panel?.classList.remove('hidden');
    btn?.setAttribute('aria-expanded', 'true');
  }
  function close() {
    panel?.classList.add('hidden');
    btn?.setAttribute('aria-expanded', 'false');
  }

  btn?.addEventListener('click', () => {
    const expanded = btn.getAttribute('aria-expanded') === 'true';
    expanded ? close() : open();
  });
  closeBtn?.addEventListener('click', close);
  panel?.querySelectorAll('a').forEach(a => a.addEventListener('click', close));
</script>