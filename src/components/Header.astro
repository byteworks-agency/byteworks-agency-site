---
interface Props {
  lang?: 'en' | 'es';
}

const { lang = 'en' } = Astro.props;

const isEN = lang === 'en';
const base = isEN ? '/en' : '/es';
const home = `${base}/`;
const plans = isEN ? `${base}/plans` : `${base}/planes`;
const contact = isEN ? `${base}/contact` : `${base}/contacto`;

// Construye el href alterno conservando la ruta actual
function altHref(targetLang: 'en' | 'es') {
  const url = new URL(Astro.url.pathname, Astro.site);
  const parts = url.pathname.split('/').filter(Boolean);
  if (parts.length === 0) return `/${targetLang}/`;
  if (parts[0] === 'en' || parts[0] === 'es') {
    parts[0] = targetLang;
  } else {
    parts.unshift(targetLang);
  }
  return `/${parts.join('/')}/`;
}

// Simple helper de clases
function cx(...classes: Array<string | false | null | undefined>) {
  return classes.filter(Boolean).join(' ');
}

// Activo por ruta
const path = Astro.url.pathname.replace(/\/+$/, '') || '/';
function isActive(href: string) {
  const clean = href.replace(/\/+$/, '') || '/';
  return path === clean;
}
---

<header class="sticky top-0 z-40 bg-white/80 dark:bg-black/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-black/60 border-b border-gray-200 dark:border-gray-800">
  <div class="px-6 md:px-10 lg:px-16 max-w-6xl mx-auto h-14 flex items-center justify-between">
    <!-- Logo -->
    <a href={home} class="font-semibold tracking-tight text-[15px] md:text-[16px]">
      ByteWorks
      <span class="sr-only">{isEN ? 'Home' : 'Inicio'}</span>
    </a>

    <!-- Desktop nav -->
    <nav class="hidden md:flex items-center gap-6 text-sm">
      <a href={home} class={cx('hover:underline', isActive(home) && 'underline underline-offset-4')}>{isEN ? 'Home' : 'Inicio'}</a>
      <a href={plans} class={cx('hover:underline', isActive(plans) && 'underline underline-offset-4')}>{isEN ? 'Plans' : 'Planes'}</a>
      <a href={contact} class={cx('hover:underline', isActive(contact) && 'underline underline-offset-4')}>{isEN ? 'Contact' : 'Contacto'}</a>

      <span aria-hidden="true" class="w-px h-4 bg-gray-200 dark:bg-gray-800"></span>

      <!-- Language toggle -->
      <a href={altHref(isEN ? 'es' : 'en')} class="px-2 py-1 rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 transition text-xs">
        {isEN ? 'ES' : 'EN'}
      </a>
    </nav>

    <!-- Mobile menu button -->
    <details class="md:hidden">
      <summary class="list-none cursor-pointer px-2 py-1 rounded border border-gray-300 dark:border-gray-700 text-sm">
        â˜°
      </summary>
      <div class="absolute left-0 right-0 mt-2 px-6 py-4 bg-white dark:bg-black border-t border-b border-gray-200 dark:border-gray-800">
        <nav class="flex flex-col gap-3 text-sm">
          <a href={home} class={cx('hover:underline', isActive(home) && 'underline')}>{isEN ? 'Home' : 'Inicio'}</a>
          <a href={plans} class={cx('hover:underline', isActive(plans) && 'underline')}>{isEN ? 'Plans' : 'Planes'}</a>
          <a href={contact} class={cx('hover:underline', isActive(contact) && 'underline')}>{isEN ? 'Contact' : 'Contacto'}</a>
          <div class="pt-2">
            <a href={altHref(isEN ? 'es' : 'en')} class="inline-block px-2 py-1 rounded border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800 transition text-xs">
              {isEN ? 'ES' : 'EN'}
            </a>
          </div>
        </nav>
      </div>
    </details>
  </div>
</header>
